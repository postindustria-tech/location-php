<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees Geo-Location PHP: cloud/webIntegration.php</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="../../documentation/4.4/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees Geo-Location PHP
   &#160;<span id="projectnumber">4.4</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">51Degrees Geo-Location for PHP</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cloud_2web_integration_8php-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">cloud/webIntegration.php</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>
<p>
This example demonstrates how to get location information from the device
that a user is using to access a website. 
In addition, JavaScript is used to update the page with postal address details 
for this location.
</p>
<p>
This works by using the <a href="http://www.51degrees.com/documentation/_features__client_side_evidence.html">client-side evidence</a> 
feature of the Pipeline.
Briefly, properties containing JavaScript snippets are populated by engines 
in the Pipeline and these are then bundled together into a single JavaScript 
block by the 'JsonBuilder' and 'JavaScriptBuilder' elements.
This JavaScript is then used to obtain the additional evidence from the 
client (in this case, latitude and longitude) and pass it back to the server. 
The Pipeline running on the server then processes this evidence to 
populate a new JSON result object that is returned to the client.
</p>
 </p>
<p>This example is available in full on <a href="https://github.com/51Degrees/location-php/blob/master/examples/cloud/webintegration.php">GitHub</a>.</p>
<p>
<p>
To run this example, you will need to create a <strong>resource key</strong>. 
The resource key is used as shorthand to store the particular set of 
properties you are interested in as well as any associated license keys 
that entitle you to increased request limits and/or paid-for properties.
</p>
<p>
You can create a resource key using the 51Degrees 
<a href="https://configure.51degrees.com">Configurator</a>.
</p>
</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;?php</div><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2023 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line">require(__DIR__ . <span class="c-code__stringliteral">&quot;/../../vendor/autoload.php&quot;</span>);</div><div class="c-code__line"></div><div class="c-code__line">use <a name="_a0"></a><a class="code" href="classfiftyone_1_1pipeline_1_1geolocation_1_1_geo_location_pipeline_builder.html">fiftyone\pipeline\geolocation\GeoLocationPipelineBuilder</a>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// Check if there is a resource key in the environment variable and use</span></div><div class="c-code__line"><span class="c-code__comment">// it if there is one. (This is used for automated testing)</span></div><div class="c-code__line"><span class="c-code__keywordflow">if</span> (isset($_ENV[<span class="c-code__stringliteral">&quot;RESOURCEKEY&quot;</span>])) {</div><div class="c-code__line">    $resourceKey = $_ENV[<span class="c-code__stringliteral">&quot;RESOURCEKEY&quot;</span>];</div><div class="c-code__line">} <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">    $resourceKey = <span class="c-code__stringliteral">&quot;!!YOUR_RESOURCE_KEY!!&quot;</span>;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keywordflow">if</span> (substr($resourceKey, 0, 2) === <span class="c-code__stringliteral">&quot;!!&quot;</span>) {</div><div class="c-code__line">    echo <span class="c-code__stringliteral">&quot;You need to create a resource key at &quot;</span> .</div><div class="c-code__line">        <span class="c-code__stringliteral">&quot;https://configure.51degrees.com/v399y42f and paste it into &quot;</span> .</div><div class="c-code__line">        <span class="c-code__stringliteral">&quot;the code, replacing !!YOUR_RESOURCE_KEY!!.&quot;</span>;</div><div class="c-code__line">    echo <span class="c-code__stringliteral">&quot;\n&lt;br/&gt;&quot;</span>;</div><div class="c-code__line">    echo <span class="c-code__stringliteral">&quot;Make sure to include the Country, State, County, Town and &quot;</span> .</div><div class="c-code__line">        <span class="c-code__stringliteral">&quot;JavaScript properties as they are used by this example.\n&lt;br /&gt;&quot;</span>;</div><div class="c-code__line">    <span class="c-code__keywordflow">return</span>;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// We create some settings for the JavaScriptBuilder,</span></div><div class="c-code__line"><span class="c-code__comment">// in this case an endpoint to call back to to retrieve additional</span></div><div class="c-code__line"><span class="c-code__comment">// properties populated by client side evidence</span></div><div class="c-code__line"><span class="c-code__comment">// this ?json endpoint is used later to serve results from a special</span></div><div class="c-code__line"><span class="c-code__comment">// json engine automatically included in the pipeline</span></div><div class="c-code__line">$javascriptBuilderSettings = array(</div><div class="c-code__line">    <span class="c-code__stringliteral">&quot;endpoint&quot;</span> =&gt; <span class="c-code__stringliteral">&quot;/?json&quot;</span></div><div class="c-code__line">);</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// Make the Pipeline and add the JavaScript settings</span></div><div class="c-code__line">$builder = <span class="c-code__keyword">new</span> GeoLocationPipelineBuilder(array(</div><div class="c-code__line">    <span class="c-code__stringliteral">&quot;resourceKey&quot;</span> =&gt; $resourceKey,</div><div class="c-code__line">    <span class="c-code__stringliteral">&quot;locationProvider&quot;</span> =&gt; <span class="c-code__stringliteral">&quot;fiftyonedegrees&quot;</span>,</div><div class="c-code__line">    <span class="c-code__stringliteral">&quot;javascriptBuilderSettings&quot;</span> =&gt; $javascriptBuilderSettings</div><div class="c-code__line">));</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// To stop having to construct the pipeline</span></div><div class="c-code__line"><span class="c-code__comment">// and re-make cloud API requests used during construction on every page load,</span></div><div class="c-code__line"><span class="c-code__comment">// we recommend caching the serialized pipeline to a database or disk.</span></div><div class="c-code__line"><span class="c-code__comment">// Below we are using PHP&#39;s serialize and writing to a file if it doesn&#39;t exist</span></div><div class="c-code__line"></div><div class="c-code__line">$serializedPipelineFile = __DIR__ . <span class="c-code__stringliteral">&quot;web_integration_pipeline.pipeline&quot;</span>;</div><div class="c-code__line"><span class="c-code__keywordflow">if</span>(!file_exists($serializedPipelineFile)){</div><div class="c-code__line">    $pipeline = $builder-&gt;build();</div><div class="c-code__line">    file_put_contents($serializedPipelineFile, serialize($pipeline));</div><div class="c-code__line">} <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">    $pipeline = unserialize(file_get_contents($serializedPipelineFile));</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// We create the flowData object that is used to add evidence to and read</span></div><div class="c-code__line"><span class="c-code__comment">// data from</span></div><div class="c-code__line">$flowData = $pipeline-&gt;createFlowData();</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// We set headers, cookies and more information from the web request</span></div><div class="c-code__line">$flowData-&gt;evidence-&gt;setFromWebRequest();</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// Now we process the flowData</span></div><div class="c-code__line">$result = $flowData-&gt;process();</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// Following the JavaScript bundler settings where we created an endpoint called</span></div><div class="c-code__line"><span class="c-code__comment">// ?json, we now use this endpoint (if called) to send back JSON to the client side</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keywordflow">if</span> (isset($_GET[<span class="c-code__stringliteral">&quot;json&quot;</span>])) {</div><div class="c-code__line">    header(<span class="c-code__stringliteral">&#39;Content-Type: application/json&#39;</span>);</div><div class="c-code__line"></div><div class="c-code__line">    echo json_encode($flowData-&gt;jsonbundler-&gt;json);</div><div class="c-code__line">    </div><div class="c-code__line">    <span class="c-code__keywordflow">return</span>;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// In the standard call we check if the required properties exist</span></div><div class="c-code__line">$properties = $pipeline-&gt;getElement(<span class="c-code__stringliteral">&quot;location&quot;</span>)-&gt;getProperties();</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keywordflow">if</span> (!isset($properties[<span class="c-code__stringliteral">&quot;country&quot;</span>]) || !isset($properties[<span class="c-code__stringliteral">&quot;state&quot;</span>]) || </div><div class="c-code__line">  !isset($properties[<span class="c-code__stringliteral">&quot;county&quot;</span>]) || !isset($properties[<span class="c-code__stringliteral">&quot;town&quot;</span>]) || </div><div class="c-code__line">  !isset($properties[<span class="c-code__stringliteral">&quot;javascript&quot;</span>])) {</div><div class="c-code__line">    echo <span class="c-code__stringliteral">&quot;Make sure to include the Country, State, County, Town and &quot;</span> .</div><div class="c-code__line">        <span class="c-code__stringliteral">&quot;JavaScript properties as they are used by this example.\n&lt;br /&gt;&quot;</span>;</div><div class="c-code__line">    <span class="c-code__keywordflow">return</span>;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;p&gt; The following values are determined sever-side on the first request. </span></div><div class="c-code__line"><span class="c-code__stringliteral">As the server has no location information to work from, </span></div><div class="c-code__line"><span class="c-code__stringliteral">these values will all be unknown:&lt;/p&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dl&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;strong&gt;Country&lt;/strong&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dd&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keywordflow">if</span> ($result-&gt;location-&gt;country-&gt;hasValue) {</div><div class="c-code__line">    echo $result-&gt;location-&gt;country-&gt;value;</div><div class="c-code__line">} <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">    echo <span class="c-code__stringliteral">&quot;Unknown (&quot;</span> . $result-&gt;location-&gt;country-&gt;noValueMessage . <span class="c-code__stringliteral">&quot;)&quot;</span>;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dd&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;strong&gt;State&lt;/strong&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dd&gt;&quot;</span>;</div><div class="c-code__line"><span class="c-code__keywordflow">if</span> ($result-&gt;location-&gt;state-&gt;hasValue) {</div><div class="c-code__line">    echo $result-&gt;location-&gt;state-&gt;value;</div><div class="c-code__line">} <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">    echo <span class="c-code__stringliteral">&quot;Unknown (&quot;</span> . $result-&gt;location-&gt;state-&gt;noValueMessage . <span class="c-code__stringliteral">&quot;)&quot;</span>;</div><div class="c-code__line">}</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dd&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;strong&gt;County&lt;/strong&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dd&gt;&quot;</span>;</div><div class="c-code__line"><span class="c-code__keywordflow">if</span> ($result-&gt;location-&gt;county-&gt;hasValue) {</div><div class="c-code__line">    echo $result-&gt;location-&gt;county-&gt;value;</div><div class="c-code__line">} <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">    echo <span class="c-code__stringliteral">&quot;Unknown (&quot;</span> . $result-&gt;location-&gt;county-&gt;noValueMessage . <span class="c-code__stringliteral">&quot;)&quot;</span>;</div><div class="c-code__line">}</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dd&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;strong&gt;Town/City&lt;/strong&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dd&gt;&quot;</span>;</div><div class="c-code__line"><span class="c-code__keywordflow">if</span> ($result-&gt;location-&gt;town-&gt;hasValue) {</div><div class="c-code__line">    echo $result-&gt;location-&gt;town-&gt;value;</div><div class="c-code__line">} <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">    echo <span class="c-code__stringliteral">&quot;Unknown (&quot;</span> . $result-&gt;location-&gt;town-&gt;noValueMessage . <span class="c-code__stringliteral">&quot;)&quot;</span>;</div><div class="c-code__line">}</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dd&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dl&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;</span></div><div class="c-code__line"><span class="c-code__stringliteral">&lt;p&gt;</span></div><div class="c-code__line"><span class="c-code__stringliteral">    When the button below is clicked, JavaScript running on the client-side </span></div><div class="c-code__line"><span class="c-code__stringliteral">    will be used to obtain additional evidence (i.e. the location information </span></div><div class="c-code__line"><span class="c-code__stringliteral">    from the device). If no additional information appears then it may </span></div><div class="c-code__line"><span class="c-code__stringliteral">    indicate an external problem such as JavaScript being disabled in </span></div><div class="c-code__line"><span class="c-code__stringliteral">    your browser.</span></div><div class="c-code__line"><span class="c-code__stringliteral">&lt;/p&gt;</span></div><div class="c-code__line"><span class="c-code__stringliteral">&lt;p&gt;</span></div><div class="c-code__line"><span class="c-code__stringliteral">    Note that the accuracy of the information is dependent on the accuracy </span></div><div class="c-code__line"><span class="c-code__stringliteral">    of the location data returned by your device. Any device that lacks GPS </span></div><div class="c-code__line"><span class="c-code__stringliteral">    is likely to return a highly inaccurate result. Among devices with GPS, </span></div><div class="c-code__line"><span class="c-code__stringliteral">    some have a significantly lower margin of error than others.</span></div><div class="c-code__line"><span class="c-code__stringliteral">&lt;/p&gt;</span></div><div class="c-code__line"><span class="c-code__stringliteral">&lt;button type=&#39;button&#39; onclick=&#39;buttonClicked()&#39;&gt;Use my location&lt;/button&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dl&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;strong&gt;Country&lt;/strong&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dd id=&#39;countryclient&#39;&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dd&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;strong&gt;State&lt;/strong&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dd id=&#39;stateclient&#39;&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dd&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;strong&gt;County&lt;/strong&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dd id=&#39;countyclient&#39;&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dd&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;strong&gt;Town/City&lt;/strong&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dt&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;dd id=&#39;townclient&#39;&gt;&quot;</span>;</div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;/dd&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// We get any JavaScript that should be placed in the page and run it.</span></div><div class="c-code__line"><span class="c-code__comment">// This will help provide client side evidence and make a request to the JSON</span></div><div class="c-code__line"><span class="c-code__comment">// endpoint to update extra properties using this evidence.</span></div><div class="c-code__line"></div><div class="c-code__line">echo <span class="c-code__stringliteral">&quot;&lt;script&gt;&quot;</span> . $flowData-&gt;javascriptbuilder-&gt;javascript . <span class="c-code__stringliteral">&quot;&lt;/script&gt;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line">?&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;!-- </div><div class="c-code__line">Now we add some additional JavaScript </div><div class="c-code__line">that will update the client side properties above <span class="c-code__keywordflow">if</span> values exist <span class="c-code__keywordflow">for</span> them </div><div class="c-code__line">in the JSON endpoint provided data </div><div class="c-code__line">--&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;script&gt;    </div><div class="c-code__line">    buttonClicked = <span class="c-code__keyword">function</span> () {</div><div class="c-code__line">        <span class="c-code__comment">// This function will fire when the JSON data object is updated</span></div><div class="c-code__line">        <span class="c-code__comment">// with information from the server.</span></div><div class="c-code__line">        <span class="c-code__comment">// The sequence is:</span></div><div class="c-code__line">        <span class="c-code__comment">// 1. Response contains JavaScript property &#39;JavaScript&#39;. This is not executed </span></div><div class="c-code__line">        <span class="c-code__comment">// immediately on the client as it will prompt the user to allow access to location.</span></div><div class="c-code__line">        <span class="c-code__comment">// 2. When the button is clicked, the fod.complete function is called, passing &#39;location&#39; </span></div><div class="c-code__line">        <span class="c-code__comment">// as the second parameter. This lets the code know that we want to execute</span></div><div class="c-code__line">        <span class="c-code__comment">// any JavaScript needed to obtain the location data that is needed to determine the </span></div><div class="c-code__line">        <span class="c-code__comment">// user&#39;s postal address details.</span></div><div class="c-code__line">        <span class="c-code__comment">// 3. The execution of the location JavaScript triggers a background callback </span></div><div class="c-code__line">        <span class="c-code__comment">// to the webserver that includes the new evidence (i.e. lat/lon).</span></div><div class="c-code__line">        <span class="c-code__comment">// 4. The web server responds with new JSON data that contains the updated </span></div><div class="c-code__line">        <span class="c-code__comment">// property values based on the new evidence.</span></div><div class="c-code__line">        <span class="c-code__comment">// 5. The JavaScript integrates the new JSON data and fires the &#39;complete&#39; </span></div><div class="c-code__line">        <span class="c-code__comment">// callback function below, which then displays the results.</span></div><div class="c-code__line">        fod.complete(<span class="c-code__keyword">function</span> (data) {</div><div class="c-code__line">            <span class="c-code__keywordflow">if</span>(data.location){</div><div class="c-code__line">                document.getElementById(<span class="c-code__stringliteral">&#39;countryclient&#39;</span>).innerHTML = data.location.country;</div><div class="c-code__line">                document.getElementById(<span class="c-code__stringliteral">&#39;stateclient&#39;</span>).innerHTML = data.location.state;</div><div class="c-code__line">                document.getElementById(<span class="c-code__stringliteral">&#39;countyclient&#39;</span>).innerHTML = data.location.county;</div><div class="c-code__line">                document.getElementById(<span class="c-code__stringliteral">&#39;townclient&#39;</span>).innerHTML = data.location.town;</div><div class="c-code__line">            } <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">                document.getElementById(<span class="c-code__stringliteral">&#39;countryclient&#39;</span>).innerHTML = <span class="c-code__stringliteral">&#39;Location data is empty. This probably means that something has gone wrong with the JavaScript evaluation.&#39;</span>;</div><div class="c-code__line">            }</div><div class="c-code__line">       }, <span class="c-code__stringliteral">&#39;location&#39;</span>);</div><div class="c-code__line">    }</div><div class="c-code__line"> &lt;/script&gt;</div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
